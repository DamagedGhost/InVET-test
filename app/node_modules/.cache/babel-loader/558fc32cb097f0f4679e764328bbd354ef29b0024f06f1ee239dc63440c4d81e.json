{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nconst API_BASE_URL = 'http://localhost:5000/api/usuarios';\nconst useUserViewModel = () => {\n  _s();\n  const [users, setUsers] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Función para obtener todos los usuarios (y recargar el estado)\n  const fetchUsers = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await fetch(API_BASE_URL);\n      if (!response.ok) {\n        throw new Error('No se pudo obtener la lista de usuarios.');\n      }\n      const data = await response.json();\n\n      // Los datos ya vienen mapeados de Mongo (_id -> id)\n      setUsers(data);\n    } catch (e) {\n      setError(e.message);\n      console.error(\"Error al cargar usuarios:\", e);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n  useEffect(() => {\n    fetchUsers();\n  }, [fetchUsers]);\n\n  // --- FUNCIÓN CREATE ---\n  const addUser = async userData => {\n    try {\n      const response = await fetch(API_BASE_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(userData)\n      });\n      const data = await response.json();\n      if (!response.ok) {\n        throw new Error(data.message || 'Error al agregar usuario.');\n      }\n\n      // Recargamos la lista para actualizar la vista\n      await fetchUsers();\n      return data.user; // Retorna el usuario creado\n    } catch (e) {\n      alert(`Error al crear usuario: ${e.message}`);\n      console.error(e);\n      return null;\n    }\n  };\n\n  // --- FUNCIÓN READ (Single) ---\n  const getUserById = id => {\n    // Busca en el estado local (asume que el estado está actualizado)\n    return users.find(u => u.id === id);\n  };\n\n  // Esta es la versión que hace fetch directo para edición\n  const fetchUserById = async id => {\n    try {\n      const response = await fetch(`${API_BASE_URL}/${id}`);\n      if (!response.ok) {\n        throw new Error('Usuario no encontrado en la base de datos.');\n      }\n      const data = await response.json();\n      return data;\n    } catch (e) {\n      console.error(\"Error al obtener usuario por ID:\", e);\n      return null;\n    }\n  };\n\n  // --- FUNCIÓN UPDATE ---\n  const updateUser = async (id, updatedData) => {\n    try {\n      const response = await fetch(`${API_BASE_URL}/${id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(updatedData)\n      });\n      const data = await response.json();\n      if (!response.ok) {\n        throw new Error(data.message || 'Error al actualizar usuario.');\n      }\n      await fetchUsers();\n      return data.user;\n    } catch (e) {\n      alert(`Error al actualizar usuario: ${e.message}`);\n      console.error(e);\n      return null;\n    }\n  };\n\n  // --- FUNCIÓN DELETE ---\n  const deleteUser = async id => {\n    try {\n      const response = await fetch(`${API_BASE_URL}/${id}`, {\n        method: 'DELETE'\n      });\n      if (!response.ok) {\n        throw new Error('Error al eliminar usuario.');\n      }\n      await fetchUsers();\n      return true;\n    } catch (e) {\n      alert(`Error al eliminar usuario: ${e.message}`);\n      console.error(e);\n      return false;\n    }\n  };\n\n  // La función de login ya no es necesaria aquí; se movió al AuthContext\n  const findUserByEmailAndPassword = () => {\n    // Ya no se usa aquí. La autenticación se hace en AuthContext.js\n    console.warn('findUserByEmailAndPassword ya no se usa, el login se gestiona en AuthContext.');\n    return null;\n  };\n  return {\n    users,\n    loading,\n    error,\n    fetchUsers,\n    addUser,\n    getUserById,\n    fetchUserById,\n    // Nueva función para obtener al editar\n    updateUser,\n    deleteUser,\n    findUserByEmailAndPassword\n  };\n};\n_s(useUserViewModel, \"8grI4Llost9qowyDywFp11Os9y0=\");\nexport default useUserViewModel;","map":{"version":3,"names":["useState","useEffect","useCallback","API_BASE_URL","useUserViewModel","_s","users","setUsers","loading","setLoading","error","setError","fetchUsers","response","fetch","ok","Error","data","json","e","message","console","addUser","userData","method","headers","body","JSON","stringify","user","alert","getUserById","id","find","u","fetchUserById","updateUser","updatedData","deleteUser","findUserByEmailAndPassword","warn"],"sources":["/home/ubuntu/InVET-test/app/src/viewmodels/useUserViewModel.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\n\r\nconst API_BASE_URL = 'http://localhost:5000/api/usuarios';\r\n\r\nconst useUserViewModel = () => {\r\n    const [users, setUsers] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n\r\n    // Función para obtener todos los usuarios (y recargar el estado)\r\n    const fetchUsers = useCallback(async () => {\r\n        setLoading(true);\r\n        setError(null);\r\n        try {\r\n            const response = await fetch(API_BASE_URL);\r\n            if (!response.ok) {\r\n                throw new Error('No se pudo obtener la lista de usuarios.');\r\n            }\r\n            const data = await response.json();\r\n            \r\n            // Los datos ya vienen mapeados de Mongo (_id -> id)\r\n            setUsers(data);\r\n        } catch (e) {\r\n            setError(e.message);\r\n            console.error(\"Error al cargar usuarios:\", e);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        fetchUsers();\r\n    }, [fetchUsers]);\r\n\r\n    // --- FUNCIÓN CREATE ---\r\n    const addUser = async (userData) => {\r\n        try {\r\n            const response = await fetch(API_BASE_URL, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(userData),\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.message || 'Error al agregar usuario.');\r\n            }\r\n            \r\n            // Recargamos la lista para actualizar la vista\r\n            await fetchUsers();\r\n            return data.user; // Retorna el usuario creado\r\n\r\n        } catch (e) {\r\n            alert(`Error al crear usuario: ${e.message}`);\r\n            console.error(e);\r\n            return null;\r\n        }\r\n    };\r\n\r\n    // --- FUNCIÓN READ (Single) ---\r\n    const getUserById = (id) => {\r\n        // Busca en el estado local (asume que el estado está actualizado)\r\n        return users.find(u => u.id === id);\r\n    };\r\n    \r\n    // Esta es la versión que hace fetch directo para edición\r\n    const fetchUserById = async (id) => {\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/${id}`);\r\n            if (!response.ok) {\r\n                throw new Error('Usuario no encontrado en la base de datos.');\r\n            }\r\n            const data = await response.json();\r\n            return data;\r\n        } catch (e) {\r\n            console.error(\"Error al obtener usuario por ID:\", e);\r\n            return null;\r\n        }\r\n    };\r\n\r\n    // --- FUNCIÓN UPDATE ---\r\n    const updateUser = async (id, updatedData) => {\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/${id}`, {\r\n                method: 'PUT',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(updatedData),\r\n            });\r\n\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.message || 'Error al actualizar usuario.');\r\n            }\r\n\r\n            await fetchUsers();\r\n            return data.user;\r\n            \r\n        } catch (e) {\r\n            alert(`Error al actualizar usuario: ${e.message}`);\r\n            console.error(e);\r\n            return null;\r\n        }\r\n    };\r\n\r\n    // --- FUNCIÓN DELETE ---\r\n    const deleteUser = async (id) => {\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/${id}`, {\r\n                method: 'DELETE',\r\n            });\r\n            \r\n            if (!response.ok) {\r\n                throw new Error('Error al eliminar usuario.');\r\n            }\r\n\r\n            await fetchUsers();\r\n            return true;\r\n            \r\n        } catch (e) {\r\n            alert(`Error al eliminar usuario: ${e.message}`);\r\n            console.error(e);\r\n            return false;\r\n        }\r\n    };\r\n\r\n    // La función de login ya no es necesaria aquí; se movió al AuthContext\r\n    const findUserByEmailAndPassword = () => {\r\n        // Ya no se usa aquí. La autenticación se hace en AuthContext.js\r\n        console.warn('findUserByEmailAndPassword ya no se usa, el login se gestiona en AuthContext.');\r\n        return null;\r\n    };\r\n\r\n    return { \r\n        users, \r\n        loading,\r\n        error,\r\n        fetchUsers,\r\n        addUser, \r\n        getUserById, \r\n        fetchUserById, // Nueva función para obtener al editar\r\n        updateUser, \r\n        deleteUser,\r\n        findUserByEmailAndPassword \r\n    };\r\n};\r\n\r\nexport default useUserViewModel;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}