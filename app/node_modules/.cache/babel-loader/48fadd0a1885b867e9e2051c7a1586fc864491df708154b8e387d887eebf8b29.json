{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nconst API_BASE_URL = 'http://localhost:5000/api/productos';\n\n// Hook principal que manejará el CRUD con la API\nconst useProductsViewModel = () => {\n  _s();\n  const [products, setProducts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Función para obtener todos los productos\n  const fetchProducts = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await fetch(API_BASE_URL);\n      if (!response.ok) {\n        throw new Error('No se pudo obtener la lista de productos.');\n      }\n      const data = await response.json();\n\n      // Mapeamos el _id de Mongo a id para compatibilidad con el código React existente\n      const mappedData = data.map(p => ({\n        ...p,\n        id: p._id // Usamos _id de MongoDB como ID en el frontend\n      }));\n      setProducts(mappedData);\n    } catch (e) {\n      setError(e.message);\n      console.error(\"Error al cargar productos:\", e);\n    } finally {\n      setLoading(false);\n    }\n  }, []); // Dependencias vacías: solo se define una vez\n\n  // Se llama a fetchProducts la primera vez que se monta el componente\n  useEffect(() => {\n    fetchProducts();\n  }, [fetchProducts]);\n\n  // --- FUNCIÓN CREATE ---\n  const addProducto = async productoData => {\n    try {\n      const response = await fetch(API_BASE_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        // Enviamos los datos del formulario directamente\n        body: JSON.stringify(productoData)\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Error al agregar producto.');\n      }\n\n      // Después de agregar, recargamos la lista para ver el nuevo producto\n      await fetchProducts();\n      return true;\n    } catch (e) {\n      alert(`Error al guardar producto: ${e.message}`);\n      console.error(e);\n      return false;\n    }\n  };\n\n  // --- FUNCIÓN READ (Single) ---\n  const getProductoById = id => {\n    // Busca en el estado local (asume que el estado está actualizado)\n    return products.find(p => p.id === id);\n  };\n\n  // Esta es la versión que hace fetch directo para edición\n  const fetchProductoById = async id => {\n    try {\n      const response = await fetch(`${API_BASE_URL}/${id}`);\n      if (!response.ok) {\n        throw new Error('Producto no encontrado en la base de datos.');\n      }\n      const data = await response.json();\n      return {\n        ...data,\n        id: data._id\n      };\n    } catch (e) {\n      console.error(\"Error al obtener producto por ID:\", e);\n      return null;\n    }\n  };\n\n  // --- FUNCIÓN UPDATE ---\n  const updateProducto = async (id, updatedData) => {\n    try {\n      const response = await fetch(`${API_BASE_URL}/${id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(updatedData)\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Error al actualizar producto.');\n      }\n\n      // Recargamos la lista\n      await fetchProducts();\n      return true;\n    } catch (e) {\n      alert(`Error al actualizar producto: ${e.message}`);\n      console.error(e);\n      return false;\n    }\n  };\n\n  // --- FUNCIÓN DELETE ---\n  const deleteProducto = async id => {\n    // Usamos el ID (que es el _id de Mongo)\n    try {\n      const response = await fetch(`${API_BASE_URL}/${id}`, {\n        method: 'DELETE'\n      });\n      if (!response.ok) {\n        throw new Error('Error al eliminar producto.');\n      }\n\n      // Recargamos la lista\n      await fetchProducts();\n      return true;\n    } catch (e) {\n      alert(`Error al eliminar producto: ${e.message}`);\n      console.error(e);\n      return false;\n    }\n  };\n\n  // Exponemos los productos (READ all) y las funciones CRUD\n  return {\n    products,\n    loading,\n    error,\n    fetchProducts,\n    addProducto,\n    getProductoById,\n    fetchProductoById,\n    // Nueva función para obtener al editar\n    updateProducto,\n    deleteProducto\n  };\n};\n_s(useProductsViewModel, \"B0cKykw2W1YWdIApKYQsi4osLNc=\");\nexport default useProductsViewModel;","map":{"version":3,"names":["useState","useEffect","useCallback","API_BASE_URL","useProductsViewModel","_s","products","setProducts","loading","setLoading","error","setError","fetchProducts","response","fetch","ok","Error","data","json","mappedData","map","p","id","_id","e","message","console","addProducto","productoData","method","headers","body","JSON","stringify","errorData","alert","getProductoById","find","fetchProductoById","updateProducto","updatedData","deleteProducto"],"sources":["/home/ubuntu/InVET-test/app/src/viewmodels/useProductsViewModel.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\n\r\nconst API_BASE_URL = 'http://localhost:5000/api/productos';\r\n\r\n// Hook principal que manejará el CRUD con la API\r\nconst useProductsViewModel = () => {\r\n  \r\n  const [products, setProducts] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Función para obtener todos los productos\r\n  const fetchProducts = useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const response = await fetch(API_BASE_URL);\r\n      if (!response.ok) {\r\n        throw new Error('No se pudo obtener la lista de productos.');\r\n      }\r\n      const data = await response.json();\r\n      \r\n      // Mapeamos el _id de Mongo a id para compatibilidad con el código React existente\r\n      const mappedData = data.map(p => ({\r\n          ...p,\r\n          id: p._id // Usamos _id de MongoDB como ID en el frontend\r\n      }));\r\n      setProducts(mappedData);\r\n    } catch (e) {\r\n      setError(e.message);\r\n      console.error(\"Error al cargar productos:\", e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []); // Dependencias vacías: solo se define una vez\r\n\r\n  // Se llama a fetchProducts la primera vez que se monta el componente\r\n  useEffect(() => {\r\n    fetchProducts();\r\n  }, [fetchProducts]); \r\n\r\n  // --- FUNCIÓN CREATE ---\r\n  const addProducto = async (productoData) => {\r\n    try {\r\n        const response = await fetch(API_BASE_URL, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            // Enviamos los datos del formulario directamente\r\n            body: JSON.stringify(productoData),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            throw new Error(errorData.message || 'Error al agregar producto.');\r\n        }\r\n\r\n        // Después de agregar, recargamos la lista para ver el nuevo producto\r\n        await fetchProducts();\r\n        return true;\r\n\r\n    } catch (e) {\r\n        alert(`Error al guardar producto: ${e.message}`);\r\n        console.error(e);\r\n        return false;\r\n    }\r\n  };\r\n\r\n  // --- FUNCIÓN READ (Single) ---\r\n  const getProductoById = (id) => {\r\n    // Busca en el estado local (asume que el estado está actualizado)\r\n    return products.find(p => p.id === id);\r\n  };\r\n    \r\n  // Esta es la versión que hace fetch directo para edición\r\n  const fetchProductoById = async (id) => {\r\n    try {\r\n        const response = await fetch(`${API_BASE_URL}/${id}`);\r\n        if (!response.ok) {\r\n            throw new Error('Producto no encontrado en la base de datos.');\r\n        }\r\n        const data = await response.json();\r\n        return { ...data, id: data._id };\r\n    } catch (e) {\r\n        console.error(\"Error al obtener producto por ID:\", e);\r\n        return null;\r\n    }\r\n  };\r\n\r\n\r\n  // --- FUNCIÓN UPDATE ---\r\n  const updateProducto = async (id, updatedData) => {\r\n    try {\r\n        const response = await fetch(`${API_BASE_URL}/${id}`, {\r\n            method: 'PUT',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(updatedData),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            throw new Error(errorData.message || 'Error al actualizar producto.');\r\n        }\r\n\r\n        // Recargamos la lista\r\n        await fetchProducts();\r\n        return true;\r\n        \r\n    } catch (e) {\r\n        alert(`Error al actualizar producto: ${e.message}`);\r\n        console.error(e);\r\n        return false;\r\n    }\r\n  };\r\n\r\n  // --- FUNCIÓN DELETE ---\r\n  const deleteProducto = async (id) => {\r\n    // Usamos el ID (que es el _id de Mongo)\r\n    try {\r\n        const response = await fetch(`${API_BASE_URL}/${id}`, {\r\n            method: 'DELETE',\r\n        });\r\n        \r\n        if (!response.ok) {\r\n            throw new Error('Error al eliminar producto.');\r\n        }\r\n\r\n        // Recargamos la lista\r\n        await fetchProducts();\r\n        return true;\r\n        \r\n    } catch (e) {\r\n        alert(`Error al eliminar producto: ${e.message}`);\r\n        console.error(e);\r\n        return false;\r\n    }\r\n  };\r\n\r\n  // Exponemos los productos (READ all) y las funciones CRUD\r\n  return { \r\n    products, \r\n    loading,\r\n    error,\r\n    fetchProducts,\r\n    addProducto, \r\n    getProductoById, \r\n    fetchProductoById, // Nueva función para obtener al editar\r\n    updateProducto, \r\n    deleteProducto \r\n  };\r\n};\r\n\r\nexport default useProductsViewModel;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}