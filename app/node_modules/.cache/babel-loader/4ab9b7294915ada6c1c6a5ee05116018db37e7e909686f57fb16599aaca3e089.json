{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\n\n// URL de tu servidor en AWS\nconst API_BASE_URL = 'http://98.91.150.2:5000/api/productos';\nconst useProductsViewModel = () => {\n  _s();\n  const [products, setProducts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // --- 1. FETCH ALL (Ya tenía useCallback, está bien) ---\n  const fetchProducts = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await fetch(API_BASE_URL);\n      if (!response.ok) throw new Error('Error al cargar productos');\n      const data = await response.json();\n      const mappedData = data.map(p => ({\n        ...p,\n        id: p._id\n      }));\n      setProducts(mappedData);\n    } catch (e) {\n      setError(e.message);\n      console.error(e);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n  useEffect(() => {\n    fetchProducts();\n  }, [fetchProducts]);\n\n  // --- 2. CREATE (Agregamos useCallback) ---\n  const addProducto = useCallback(async productoData => {\n    try {\n      const response = await fetch(API_BASE_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(productoData)\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Error al agregar');\n      }\n      await fetchProducts(); // Recargar lista\n      return true;\n    } catch (e) {\n      alert(`Error: ${e.message}`);\n      return false;\n    }\n  }, [fetchProducts]); // Dependencia: fetchProducts\n\n  // --- 3. READ SINGLE (Sync) ---\n  const getProductoById = useCallback(id => {\n    return products.find(p => p.id === id);\n  }, [products]);\n\n  // --- 4. READ SINGLE ASYNC (Agregamos useCallback) ---\n  // AQUÍ ESTABA EL PROBLEMA DEL CICLO INFINITO\n  const fetchProductoById = useCallback(async id => {\n    const url = `${API_BASE_URL}/${id}`;\n    try {\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Producto no encontrado');\n      const data = await response.json();\n      return {\n        ...data,\n        id: data._id\n      };\n    } catch (e) {\n      console.error(\"Error fetchProductoById:\", e);\n      return null;\n    }\n  }, []); // Sin dependencias externas que cambien\n\n  // --- 5. UPDATE (Agregamos useCallback) ---\n  const updateProducto = useCallback(async (id, updatedData) => {\n    const url = `${API_BASE_URL}/${id}`;\n    try {\n      const response = await fetch(url, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(updatedData)\n      });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Error al actualizar');\n      }\n      await fetchProducts();\n      return true;\n    } catch (e) {\n      alert(`Error: ${e.message}`);\n      return false;\n    }\n  }, [fetchProducts]);\n\n  // --- 6. DELETE (Agregamos useCallback) ---\n  const deleteProducto = useCallback(async id => {\n    const url = `${API_BASE_URL}/${id}`;\n    try {\n      const response = await fetch(url, {\n        method: 'DELETE'\n      });\n      if (!response.ok) throw new Error('Error al eliminar');\n      await fetchProducts();\n      return true;\n    } catch (e) {\n      alert(`Error: ${e.message}`);\n      return false;\n    }\n  }, [fetchProducts]);\n  return {\n    products,\n    loading,\n    error,\n    fetchProducts,\n    addProducto,\n    getProductoById,\n    fetchProductoById,\n    updateProducto,\n    deleteProducto\n  };\n};\n_s(useProductsViewModel, \"FP0JwMrp4uNB8ThBymYSFdyJ6MQ=\");\nexport default useProductsViewModel;","map":{"version":3,"names":["useState","useEffect","useCallback","API_BASE_URL","useProductsViewModel","_s","products","setProducts","loading","setLoading","error","setError","fetchProducts","response","fetch","ok","Error","data","json","mappedData","map","p","id","_id","e","message","console","addProducto","productoData","method","headers","body","JSON","stringify","errorData","alert","getProductoById","find","fetchProductoById","url","updateProducto","updatedData","deleteProducto"],"sources":["C:/Users/felip/Proyectos/GitHub/InVET-test/app/src/viewmodels/useProductsViewModel.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\n\r\n// URL de tu servidor en AWS\r\nconst API_BASE_URL = 'http://98.91.150.2:5000/api/productos';\r\n\r\nconst useProductsViewModel = () => {\r\n  \r\n  const [products, setProducts] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // --- 1. FETCH ALL (Ya tenía useCallback, está bien) ---\r\n  const fetchProducts = useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const response = await fetch(API_BASE_URL);\r\n      if (!response.ok) throw new Error('Error al cargar productos');\r\n      const data = await response.json();\r\n      \r\n      const mappedData = data.map(p => ({ ...p, id: p._id }));\r\n      setProducts(mappedData);\r\n    } catch (e) {\r\n      setError(e.message);\r\n      console.error(e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchProducts();\r\n  }, [fetchProducts]); \r\n\r\n  // --- 2. CREATE (Agregamos useCallback) ---\r\n  const addProducto = useCallback(async (productoData) => {\r\n    try {\r\n        const response = await fetch(API_BASE_URL, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(productoData),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            throw new Error(errorData.message || 'Error al agregar');\r\n        }\r\n\r\n        await fetchProducts(); // Recargar lista\r\n        return true;\r\n\r\n    } catch (e) {\r\n        alert(`Error: ${e.message}`);\r\n        return false;\r\n    }\r\n  }, [fetchProducts]); // Dependencia: fetchProducts\r\n\r\n  // --- 3. READ SINGLE (Sync) ---\r\n  const getProductoById = useCallback((id) => {\r\n    return products.find(p => p.id === id);\r\n  }, [products]);\r\n    \r\n  // --- 4. READ SINGLE ASYNC (Agregamos useCallback) ---\r\n  // AQUÍ ESTABA EL PROBLEMA DEL CICLO INFINITO\r\n  const fetchProductoById = useCallback(async (id) => {\r\n    const url = `${API_BASE_URL}/${id}`;\r\n    try {\r\n        const response = await fetch(url);\r\n        if (!response.ok) throw new Error('Producto no encontrado');\r\n        const data = await response.json();\r\n        return { ...data, id: data._id };\r\n    } catch (e) {\r\n        console.error(\"Error fetchProductoById:\", e);\r\n        return null;\r\n    }\r\n  }, []); // Sin dependencias externas que cambien\r\n\r\n  // --- 5. UPDATE (Agregamos useCallback) ---\r\n  const updateProducto = useCallback(async (id, updatedData) => {\r\n    const url = `${API_BASE_URL}/${id}`;\r\n    try {\r\n        const response = await fetch(url, {\r\n            method: 'PUT',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(updatedData),\r\n        });\r\n        \r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            throw new Error(errorData.message || 'Error al actualizar');\r\n        }\r\n\r\n        await fetchProducts();\r\n        return true;\r\n        \r\n    } catch (e) {\r\n        alert(`Error: ${e.message}`);\r\n        return false;\r\n    }\r\n  }, [fetchProducts]);\r\n\r\n  // --- 6. DELETE (Agregamos useCallback) ---\r\n  const deleteProducto = useCallback(async (id) => {\r\n    const url = `${API_BASE_URL}/${id}`;\r\n    try {\r\n        const response = await fetch(url, { method: 'DELETE' });\r\n        if (!response.ok) throw new Error('Error al eliminar');\r\n\r\n        await fetchProducts();\r\n        return true;\r\n    } catch (e) {\r\n        alert(`Error: ${e.message}`);\r\n        return false;\r\n    }\r\n  }, [fetchProducts]);\r\n\r\n  return { \r\n    products, \r\n    loading,\r\n    error,\r\n    fetchProducts,\r\n    addProducto, \r\n    getProductoById, \r\n    fetchProductoById, \r\n    updateProducto, \r\n    deleteProducto \r\n  };\r\n};\r\n\r\nexport default useProductsViewModel;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}