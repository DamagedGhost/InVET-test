{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nconst API_BASE_URL = 'http://98.91.150.2:5000/api/productos';\n\n// Hook principal que manejará el CRUD con la API\nconst useProductsViewModel = () => {\n  _s();\n  const [products, setProducts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Función para obtener todos los productos\n  const fetchProducts = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n    console.log(`[FE-PROD] ➡️ Llamada GET: ${API_BASE_URL}`);\n    try {\n      const response = await fetch(API_BASE_URL);\n      console.log(`[FE-PROD] ⬅️ Respuesta GET. Status: ${response.status}`);\n      if (!response.ok) {\n        throw new Error('No se pudo obtener la lista de productos.');\n      }\n      const data = await response.json();\n      const mappedData = data.map(p => ({\n        ...p,\n        id: p._id // Usamos _id de MongoDB como ID en el frontend\n      }));\n      setProducts(mappedData);\n      console.log(`[FE-PROD] ✅ ${mappedData.length} productos cargados.`);\n    } catch (e) {\n      setError(e.message);\n      console.error(\"[FE-PROD] ❌ Error al cargar productos:\", e.message);\n    } finally {\n      setLoading(false);\n    }\n  }, []); // Dependencias vacías: solo se define una vez\n\n  // Se llama a fetchProducts la primera vez que se monta el componente\n  useEffect(() => {\n    fetchProducts();\n  }, [fetchProducts]);\n\n  // --- FUNCIÓN CREATE ---\n  const addProducto = async productoData => {\n    console.log('[FE-PROD] ➡️ Llamada POST para crear:', productoData.title);\n    try {\n      const response = await fetch(API_BASE_URL, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(productoData)\n      });\n      console.log(`[FE-PROD] ⬅️ Respuesta POST. Status: ${response.status}`);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Error al agregar producto.');\n      }\n      console.log('[FE-PROD] ✅ Producto creado exitosamente. Recargando lista...');\n      await fetchProducts();\n      return true;\n    } catch (e) {\n      alert(`Error al guardar producto: ${e.message}`);\n      console.error(\"[FE-PROD] ❌ Error en POST:\", e.message);\n      return false;\n    }\n  };\n\n  // --- FUNCIÓN READ (Single) ---\n  const getProductoById = id => {\n    return products.find(p => p.id === id);\n  };\n\n  // Esta es la versión que hace fetch directo para edición\n  const fetchProductoById = async id => {\n    const url = `${API_BASE_URL}/${id}`;\n    console.log(`[FE-PROD] ➡️ Llamada GET single: ${url}`);\n    try {\n      const response = await fetch(url);\n      console.log(`[FE-PROD] ⬅️ Respuesta GET single. Status: ${response.status}`);\n      if (!response.ok) {\n        throw new Error('Producto no encontrado en la base de datos.');\n      }\n      const data = await response.json();\n      console.log('[FE-PROD] ✅ Producto individual obtenido.');\n      return {\n        ...data,\n        id: data._id\n      };\n    } catch (e) {\n      console.error(\"[FE-PROD] ❌ Error al obtener producto por ID:\", e.message);\n      return null;\n    }\n  };\n\n  // --- FUNCIÓN UPDATE ---\n  const updateProducto = async (id, updatedData) => {\n    const url = `${API_BASE_URL}/${id}`;\n    console.log(`[FE-PROD] ➡️ Llamada PUT para ID: ${id}`);\n    try {\n      const response = await fetch(url, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(updatedData)\n      });\n      console.log(`[FE-PROD] ⬅️ Respuesta PUT. Status: ${response.status}`);\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.message || 'Error al actualizar producto.');\n      }\n      console.log('[FE-PROD] ✅ Producto actualizado exitosamente. Recargando lista...');\n      await fetchProducts();\n      return true;\n    } catch (e) {\n      alert(`Error al actualizar producto: ${e.message}`);\n      console.error(\"[FE-PROD] ❌ Error en PUT:\", e.message);\n      return false;\n    }\n  };\n\n  // --- FUNCIÓN DELETE ---\n  const deleteProducto = async id => {\n    const url = `${API_BASE_URL}/${id}`;\n    console.log(`[FE-PROD] ➡️ Llamada DELETE para ID: ${id}`);\n    try {\n      const response = await fetch(url, {\n        method: 'DELETE'\n      });\n      console.log(`[FE-PROD] ⬅️ Respuesta DELETE. Status: ${response.status}`);\n      if (!response.ok) {\n        throw new Error('Error al eliminar producto.');\n      }\n      console.log('[FE-PROD] ✅ Producto eliminado exitosamente. Recargando lista...');\n      await fetchProducts();\n      return true;\n    } catch (e) {\n      alert(`Error al eliminar producto: ${e.message}`);\n      console.error(\"[FE-PROD] ❌ Error en DELETE:\", e.message);\n      return false;\n    }\n  };\n\n  // Exponemos los productos (READ all) y las funciones CRUD\n  return {\n    products,\n    loading,\n    error,\n    fetchProducts,\n    addProducto,\n    getProductoById,\n    fetchProductoById,\n    // Nueva función para obtener al editar\n    updateProducto,\n    deleteProducto\n  };\n};\n_s(useProductsViewModel, \"B0cKykw2W1YWdIApKYQsi4osLNc=\");\nexport default useProductsViewModel;","map":{"version":3,"names":["useState","useEffect","useCallback","API_BASE_URL","useProductsViewModel","_s","products","setProducts","loading","setLoading","error","setError","fetchProducts","console","log","response","fetch","status","ok","Error","data","json","mappedData","map","p","id","_id","length","e","message","addProducto","productoData","title","method","headers","body","JSON","stringify","errorData","alert","getProductoById","find","fetchProductoById","url","updateProducto","updatedData","deleteProducto"],"sources":["/home/ubuntu/InVET-test/app/src/viewmodels/useProductsViewModel.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\n\r\nconst API_BASE_URL = 'http://98.91.150.2:5000/api/productos';\r\n\r\n// Hook principal que manejará el CRUD con la API\r\nconst useProductsViewModel = () => {\r\n  \r\n  const [products, setProducts] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Función para obtener todos los productos\r\n  const fetchProducts = useCallback(async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    console.log(`[FE-PROD] ➡️ Llamada GET: ${API_BASE_URL}`);\r\n    try {\r\n      const response = await fetch(API_BASE_URL);\r\n      console.log(`[FE-PROD] ⬅️ Respuesta GET. Status: ${response.status}`);\r\n      \r\n      if (!response.ok) {\r\n        throw new Error('No se pudo obtener la lista de productos.');\r\n      }\r\n      const data = await response.json();\r\n      \r\n      const mappedData = data.map(p => ({\r\n          ...p,\r\n          id: p._id // Usamos _id de MongoDB como ID en el frontend\r\n      }));\r\n      setProducts(mappedData);\r\n      console.log(`[FE-PROD] ✅ ${mappedData.length} productos cargados.`);\r\n    } catch (e) {\r\n      setError(e.message);\r\n      console.error(\"[FE-PROD] ❌ Error al cargar productos:\", e.message);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []); // Dependencias vacías: solo se define una vez\r\n\r\n  // Se llama a fetchProducts la primera vez que se monta el componente\r\n  useEffect(() => {\r\n    fetchProducts();\r\n  }, [fetchProducts]); \r\n\r\n  // --- FUNCIÓN CREATE ---\r\n  const addProducto = async (productoData) => {\r\n    console.log('[FE-PROD] ➡️ Llamada POST para crear:', productoData.title);\r\n    try {\r\n        const response = await fetch(API_BASE_URL, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(productoData),\r\n        });\r\n\r\n        console.log(`[FE-PROD] ⬅️ Respuesta POST. Status: ${response.status}`);\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            throw new Error(errorData.message || 'Error al agregar producto.');\r\n        }\r\n\r\n        console.log('[FE-PROD] ✅ Producto creado exitosamente. Recargando lista...');\r\n        await fetchProducts();\r\n        return true;\r\n\r\n    } catch (e) {\r\n        alert(`Error al guardar producto: ${e.message}`);\r\n        console.error(\"[FE-PROD] ❌ Error en POST:\", e.message);\r\n        return false;\r\n    }\r\n  };\r\n\r\n  // --- FUNCIÓN READ (Single) ---\r\n  const getProductoById = (id) => {\r\n    return products.find(p => p.id === id);\r\n  };\r\n    \r\n  // Esta es la versión que hace fetch directo para edición\r\n  const fetchProductoById = async (id) => {\r\n    const url = `${API_BASE_URL}/${id}`;\r\n    console.log(`[FE-PROD] ➡️ Llamada GET single: ${url}`);\r\n    try {\r\n        const response = await fetch(url);\r\n        console.log(`[FE-PROD] ⬅️ Respuesta GET single. Status: ${response.status}`);\r\n        \r\n        if (!response.ok) {\r\n            throw new Error('Producto no encontrado en la base de datos.');\r\n        }\r\n        const data = await response.json();\r\n        console.log('[FE-PROD] ✅ Producto individual obtenido.');\r\n        return { ...data, id: data._id };\r\n    } catch (e) {\r\n        console.error(\"[FE-PROD] ❌ Error al obtener producto por ID:\", e.message);\r\n        return null;\r\n    }\r\n  };\r\n\r\n\r\n  // --- FUNCIÓN UPDATE ---\r\n  const updateProducto = async (id, updatedData) => {\r\n    const url = `${API_BASE_URL}/${id}`;\r\n    console.log(`[FE-PROD] ➡️ Llamada PUT para ID: ${id}`);\r\n    try {\r\n        const response = await fetch(url, {\r\n            method: 'PUT',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(updatedData),\r\n        });\r\n        \r\n        console.log(`[FE-PROD] ⬅️ Respuesta PUT. Status: ${response.status}`);\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            throw new Error(errorData.message || 'Error al actualizar producto.');\r\n        }\r\n\r\n        console.log('[FE-PROD] ✅ Producto actualizado exitosamente. Recargando lista...');\r\n        await fetchProducts();\r\n        return true;\r\n        \r\n    } catch (e) {\r\n        alert(`Error al actualizar producto: ${e.message}`);\r\n        console.error(\"[FE-PROD] ❌ Error en PUT:\", e.message);\r\n        return false;\r\n    }\r\n  };\r\n\r\n  // --- FUNCIÓN DELETE ---\r\n  const deleteProducto = async (id) => {\r\n    const url = `${API_BASE_URL}/${id}`;\r\n    console.log(`[FE-PROD] ➡️ Llamada DELETE para ID: ${id}`);\r\n    try {\r\n        const response = await fetch(url, {\r\n            method: 'DELETE',\r\n        });\r\n        \r\n        console.log(`[FE-PROD] ⬅️ Respuesta DELETE. Status: ${response.status}`);\r\n        \r\n        if (!response.ok) {\r\n            throw new Error('Error al eliminar producto.');\r\n        }\r\n\r\n        console.log('[FE-PROD] ✅ Producto eliminado exitosamente. Recargando lista...');\r\n        await fetchProducts();\r\n        return true;\r\n        \r\n    } catch (e) {\r\n        alert(`Error al eliminar producto: ${e.message}`);\r\n        console.error(\"[FE-PROD] ❌ Error en DELETE:\", e.message);\r\n        return false;\r\n    }\r\n  };\r\n\r\n  // Exponemos los productos (READ all) y las funciones CRUD\r\n  return { \r\n    products, \r\n    loading,\r\n    error,\r\n    fetchProducts,\r\n    addProducto, \r\n    getProductoById, \r\n    fetchProductoById, // Nueva función para obtener al editar\r\n    updateProducto, \r\n    deleteProducto \r\n  };\r\n};\r\n\r\nexport default useProductsViewModel;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}